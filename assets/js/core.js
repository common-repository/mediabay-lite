var mediaConfig=mediabayConfig,coreFilter={categoryID:"",page:1},MediabayCore={iaoAlertTime:"5000",iaoAlertPosition:"top-right",alertSuccessIcon:'<span class="icon_holder success"></span>',alertWarningIcon:'<span class="icon_holder warning">!</span>',slugError:'<span class="error_note">'+mediaConfig.slugError+"</span>",enterName:'<span class="error_note">'+mediaConfig.enterName+"</span>",ajaxurl:mediaConfig.ajaxUrl,uploadURL:mediaConfig.uploadURL,nonce:mediaConfig.nonce,areYouSure:mediaConfig.areYouSure,clearText:mediaConfig.clearText,willBeMovedToUncategorized:mediaConfig.willBeMovedToUncategorized,confirmText:mediaConfig.confirmText,cancelText:mediaConfig.cancelText,newFolderText:mediaConfig.newFolderText,renameText:mediaConfig.renameText,clearMediaText:mediaConfig.clearMediaText,deleteText:mediaConfig.deleteText,pluginURL:mediaConfig.pluginURL,hasSubFolder:mediaConfig.hasSubFolder,plugin:mediaConfig.plugin,moveOneFile:mediaConfig.moveOneFile,moveText:mediaConfig.move,filesText:mediaConfig.files,itemText:mediaConfig.item,itemsText:mediaConfig.items,noItemDOM:mediaConfig.noItemDOM,tooltipForListMode:null,minWidth:250,maxWidth:750,menuItemDepthPerLevel:18,globalMaxDepth:11,menuList:void 0,menusChanged:!1,isRTL:!("undefined"==typeof isRtl||!isRtl),negateIfRTL:"undefined"!=typeof isRtl&&isRtl?-1:1,currentParent:null,oldParent:null,mediabayCurrentFolder:localStorage.getItem("mediabayCurrentFolder")||"all",mediabayState:localStorage.getItem("mediabayTreeState")?localStorage.getItem("mediabayTreeState").split(","):[],mediabayIsListNoFolder:localStorage.getItem("mediabayIsListNoFolder")||0,init:function(){"use strict";this.isRTL&&(this.iaoAlertPosition="top-left"),this.alertSuccessIcon='<span class="icon_holder success">'+this.getIcon("check")+"</span>",jQuery("body").addClass("mediabay-admin-panel"),this.mediabayState=this.removeDuplicates(this.mediabayState),this.appendSidebarToBody(),jQuery(".cc_mediabay_sidebar").length&&(jQuery(".update-nag").remove(),this.menuList=jQuery("#mediabay_be_folder_list"),this.extensionsForMediabay(),this.menuList.length&&this.sortableCategories(),this.addIcons(),this.appendMovingPopup(),this.magicSVG(),this.callMovingPopup(),this.addNewFolderByTopButton(),this.addNewFolderByContextMenu(),this.cancelAddingNewCategory(),this.splitter(),this.triggerCustomMenu(),this.startSearchFolder(),this.detectAnyChange()),this.isListMode()&&(this.appendDragger(),this.tooltipForListMode=jQuery("#mediabay-dragger"),this.setFolderFilterForList(),this.movingMediaForListMode())},setFolderFilterForList:function(){"use strict";jQuery.each(mediabayFolders,function(e,t){jQuery(".wpmediacategory-filter").append('<option value="'+t.folderID+'">'+t.folderName+"</option>")});var e=new URL(window.location.href).searchParams.get("cc_mediabay_folder");jQuery('.cc_mediabay_header .header_bottom ul li[data-id="all"]').addClass("active"),null!=e&&this.defineAndSetActiveCategory()},detectAnyChange:function(){"use strict";jQuery(window).on("click",function(){jQuery(".mediabay-modal .media-frame").hasClass("hide-router")?jQuery(".mediabay-modal").addClass("closed"):jQuery(".mediabay-modal").removeClass("closed")})},triggerCustomMenu:function(){"use strict";jQuery(".mediabay-custom-menu-trigger").on("click",function(){jQuery(this).hasClass("closed")?(jQuery(".mediabay-custom-menu").removeClass("closed"),jQuery(this).removeClass("closed")):(jQuery(".mediabay-custom-menu").addClass("closed"),jQuery(this).addClass("closed"))})},appendDragger:function(){"use strict";0===jQuery("#mediabay-dragger").length&&jQuery("body").append('<div id="mediabay-dragger" data-id="">'+this.moveOneFile+"</div>")},movingMediaForListMode:function(){"use strict";jQuery(".wpmediacategory-filter").val(this.mediabayCurrentFolder),jQuery(".wpmediacategory-filter").trigger("change"),localStorage.setItem("mediabayCurrentFolder",this.mediabayCurrentFolder),this.dragDropListMode()},moveMultipleMediaForListMode:function(e,t){"use strict";var a=this,r={action:"mediabayAjaxMoveMultipleMedia",IDs:e,folderID:t};a.startPreloader(),jQuery.each(e,function(e,t){jQuery("#post-"+t).addClass("cc_opacity")}),jQuery.ajax({type:"POST",url:a.ajaxurl,cache:!1,data:r,success:function(t){if(jQuery.parseJSON(t).result.forEach(function(e){a.updateCount(e.from,e.to)}),null!==jQuery(".wpmediacategory-filter").val()){jQuery.each(e,function(e,t){jQuery("#post-"+t).remove()});var r=jQuery(".wp-list-table tbody tr").length;0===r?(jQuery(".wp-list-table tbody").append(a.noItemDOM),jQuery(".displaying-num").hide()):jQuery(".displaying-num").text(r+" "+(1===r?a.itemText:a.itemsText))}jQuery(".wp-list-table tbody tr").removeClass("cc_opacity"),a.stopPreloader()},error:function(e,t,a){console.log(a),console.log(t),console.log(e)}})},updateCount:function(e,t){"use strict";if((e=parseInt(e))!==(t=parseInt(t))){if(e){var a=jQuery('.wrap-all ul li.category_item[data-id="'+e+'"] .cc_count').text();(a=parseInt(a)-1)?jQuery('.wrap-all ul li.category_item[data-id="'+e+'"] .cc_count').text(a):jQuery('.wrap-all ul li.category_item[data-id="'+e+'"] .cc_count').text(0)}if(t){var r=jQuery('.wrap-all ul li.category_item[data-id="'+t+'"] .cc_count').text();r=parseInt(r)+1,jQuery('.wrap-all ul li.category_item[data-id="'+t+'"] .cc_count').text(r)}}},getSelectedFilesForListMode:function(){"use strict";var e=jQuery('.wp-list-table input[name="media[]"]:checked'),t=[];return!!e.length&&(e.each(function(e,a){t.push(jQuery(a).val())}),t)},moveSingleMediaForListMode:function(e){"use strict";var t=this,a=t.tooltipForListMode.data("id"),r=jQuery('.attachment[data-id="'+a+'"]'),i=jQuery(".wpmediacategory-filter").val();if(i=jQuery(".category_item.active").attr("data-id"),"all"===e||e===i)return jQuery(".wp-list-table tbody tr").removeClass("cc_opacity"),!1;t.startPreloader(),jQuery("#post-"+a).addClass("cc_opacity");var o={action:"mediabayAjaxGetTermsByMedia",nonce:t.nonce,ID:a};jQuery.ajax({type:"POST",url:t.ajaxurl,cache:!1,data:o,success:function(o){var n=jQuery.parseJSON(o);"no"===n.error?t.moveSingleMediaAjaxProcessForListMode(n.terms,e,a,i,r):t.stopPreloader()},error:function(e,t,a){console.log(a),console.log(t),console.log(e)}})},moveSingleMediaAjaxProcessForListMode:function(e,t,a,r,i){"use strict";var o=this,n=Array.from(e,e=>e.term_id);if(n.includes(parseInt(t)))return o.stopPreloader(),void jQuery(".wp-list-table tbody tr").removeClass("cc_opacity");var c={};c[a]={menu_order:0};var s={action:"mediabayAjaxMoveSingleMedia",attachments:c,mediaID:a,folderID:t};jQuery.ajax({type:"POST",url:o.ajaxurl,cache:!1,data:s,success:function(e){if("no"===jQuery.parseJSON(e).error&&(jQuery.each(n,function(e,a){o.updateCount(a,t)}),"all"!==r||n.length||o.updateCount(-1,t),-1===parseInt(r)&&o.updateCount(-1,t),"all"!==r&&i.detach()),o.stopPreloader(),jQuery(".wp-list-table tbody tr").removeClass("cc_opacity"),null!==jQuery(".wpmediacategory-filter").val()){jQuery("#post-"+a).remove();var c=jQuery(".wp-list-table tbody tr").length;0===c?(jQuery(".wp-list-table tbody").append(o.noItemDOM),jQuery(".displaying-num").hide()):jQuery(".displaying-num").text(c+" "+(1===c?o.itemText:o.itemsText))}},error:function(e,t,a){console.log(a),console.log(t),console.log(e)}})},splitter:function(){"use strict";console.log("asd");var e=this;jQuery(".cc_mediabay_sidebar").mediabayResize({handleSelector:".mediabay_splitter.active",resizeHeight:!1,onDrag:function(t,a,r){if(a.css("overflow","initial"),r<=e.minWidth||r>=e.maxWidth)return!1;console.log(r),jQuery(".cc_mediabay_sidebar_in").css({width:r+"px"})}})},defineAndSetActiveCategory:function(){"use strict";var e;e=this.mediabayCurrentFolder,jQuery('.cc_mediabay_header .header_bottom ul li[data-id="all"]').removeClass("active"),"all"===e?jQuery('.cc_mediabay_header .header_bottom ul li[data-id="all"]').addClass("active"):parseInt(e)>0?jQuery("#cc_category_item_"+e).addClass("active"):-1===parseInt(e)&&jQuery('.cc_mediabay_header .header_bottom ul li[data-id="-1"]').addClass("active"),this.isListMode()?(0===jQuery("ul.cc_mediabay_category_list li.category_item").length&&-1===parseInt(e)&&(this.mediabayCurrentFolder="all",e="all",this.mediabayIsListNoFolder=-1,localStorage.setItem("mediabayIsListNoFolder",this.mediabayIsListNoFolder)),0===jQuery("ul.cc_mediabay_category_list li.category_item").length&&-1===parseInt(this.mediabayIsListNoFolder)&&(this.mediabayCurrentFolder="all",e="all",this.mediabayIsListNoFolder=-1,localStorage.setItem("mediabayIsListNoFolder",this.mediabayIsListNoFolder))):(this.mediabayIsListNoFolder=0,localStorage.setItem("mediabayIsListNoFolder",this.mediabayIsListNoFolder)),jQuery(".wpmediacategory-filter").val(this.mediabayCurrentFolder),jQuery(".wpmediacategory-filter").trigger("change"),jQuery(".attachments").css("height","auto")},dragDropListMode:function(){"use strict";var e=this,t=jQuery("#mediabay-dragger"),a=e.moveOneFile;jQuery("table.wp-list-table tr").draggable({revert:"invalid",containment:"document",cursor:"move",cursorAt:{left:2,top:2},helper:function(){return jQuery("<div></div>")},start:function(){var r=jQuery('.wp-list-table input[name="media[]"]:checked').length;r>0&&(a=e.moveText+" "+r+" "+e.filesText),jQuery("body").addClass("cc_draging"),t.html(a),t.addClass("active")},stop:function(){jQuery("body").removeClass("cc_draging"),t.removeClass("active"),a=e.moveOneFile},drag:function(){var e=jQuery(this).attr("id");e=e.match(/post-([\d]+)/)[1],t.data("id",e),t.css({top:event.clientY-15,left:event.clientX-15})}}),jQuery("li.category_item").droppable({accept:"table.wp-list-table tr",hoverClass:"hover",classes:{"ui-droppable-active":"ui-state-highlight"},drop:function(){var t=jQuery(this).attr("data-id"),a=e.getSelectedFilesForListMode();a.length?e.moveMultipleMediaForListMode(a,t):e.moveSingleMediaForListMode(t)}})},addIcons:function(){var e=this,t=e.menuList.find("li.category_item");jQuery.each(t,function(t,a){var r=jQuery(a).menuItemDepth(),i=jQuery(a).next();i.hasClass("category_item")&&(i.menuItemDepth()>r&&(e.mediabayState.indexOf(jQuery(a).data("id").toString())<0?(jQuery(a).childMenuItems().wrapAll('<li class="new-wrapper children_of_'+jQuery(a).attr("id")+'"><ul></ul></li>'),jQuery(a).find(".cc_dropdown").addClass("has_children").addClass("close")):jQuery(a).find(".cc_dropdown").addClass("has_children").addClass("open")))}),jQuery(document).on("click",".cc_dropdown.has_children",function(t){t.stopPropagation(),t.preventDefault();var a=jQuery(this),r=a.closest("li.category_item"),i=r.data("id");a.hasClass("open")?(r.childMenuItems().wrapAll('<li class="new-wrapper children_of_'+r.attr("id")+'"><ul></ul></li>'),a.removeClass("open").addClass("close"),e.mediabayState.splice(e.mediabayState.indexOf(i.toString()),1),localStorage.setItem("mediabayTreeState",e.mediabayState)):a.hasClass("close")&&(jQuery(".children_of_"+r.attr("id")+" > ul > li.category_item").unwrap().unwrap(),a.removeClass("close").addClass("open"),e.mediabayState.indexOf(i.toString())<0&&(i=i.toString(),e.mediabayState.push(i),localStorage.setItem("mediabayTreeState",e.mediabayState))),localStorage.setItem("mediabayCurrentFolder",i),e.updateFolderPosition()})},refreshFolderPositionAjax:function(e,t){var a=this,r={action:"mediabayAjaxMoveCategory",current:e,parent:t};jQuery.ajax({type:"POST",url:a.ajaxurl,cache:!0,data:r,success:function(e){"no"===jQuery.parseJSON(e).error&&a.updateFolderPosition()},error:function(e,t,a){console.log(a),console.log(t),console.log(e)}})},updateFolderPosition:function(){var e=this,t="",a="";e.startPreloader(),jQuery(".cc_mediabay_sidebar .input_category_id").each(function(){var e=jQuery(this).val();""!==t&&(t+="#"),t=t+e+","+(a+="0")});var r={action:"mediabayAjaxUpdateFolderPosition",data:t};jQuery.ajax({type:"POST",url:e.ajaxurl,cache:!0,data:r,success:function(){e.stopPreloader()},error:function(e,t,a){console.log(a),console.log(t),console.log(e)}})},extensionsForMediabay:function(){var e=this;jQuery.fn.extend({ccMoveCursorToEnd:function(){this.focus();var e=this.val();return this.val("").val(e),this},refreshFoldersPosition:function(){return this.each(function(){var t=jQuery(this),a=parseInt(t.menuItemDepth(),10),r=a-1,i=t.prevAll(".category_item_depth_"+r).first(),o=0,n=t.find(".input_category_id").val();0!==a&&(o=i.find(".input_category_id").val()),e.refreshFolderPositionAjax(n,o)})},menuItemDepth:function(){var t=e.isRTL?this.eq(0).css("margin-right"):this.eq(0).css("margin-left");return e.pxToDepth(t&&-1!=t.indexOf("px")?t.slice(0,-2):0)},updateDepthClass:function(e,t){return this.each(function(){var a=jQuery(this);t=t||a.menuItemDepth(),jQuery(this).removeClass("category_item_depth_"+t).addClass("category_item_depth_"+e)})},shiftDepthClass:function(e){return this.each(function(){var t=jQuery(this),a=t.menuItemDepth(),r=parseInt(a+e);t.removeClass("category_item_depth_"+a).addClass("category_item_depth_"+r),0===r&&t.find(".is-submenu").hide()})},childMenuItems:function(){var e=jQuery();return this.each(function(){for(var t=jQuery(this),a=t.menuItemDepth(),r=t.next("li");r.length&&r.menuItemDepth()>a||r.hasClass("new-wrapper");)e=e.add(r),r=r.next("li")}),e},updateParentMenuItemDBId:function(){return this.each(function(){var t=jQuery(this),a=t.find(".input_parent_id"),r=parseInt(t.menuItemDepth(),10),i=r-1,o=t.prevAll(".category_item_depth_"+i).first(),n=0;0!==parseInt(r)&&(n=o.find(".input_category_id").val()),a.val(n),parseInt(n)!==e.currentParent&&(jQuery.event.trigger({type:"MediabayCoreTree_parent_changed",new_parent:n,id:t.find(".input_category_id").val()}),e.mediabayState.push(n),e.mediabayState=e.removeDuplicates(e.mediabayState),localStorage.setItem("mediabayTreeState",e.mediabayState)),e.currentParent=null})}})},sortableCategories:function(){var e,t,a,r,i,o,n,c,s,l,d=this,u=0,y=d.menuList.offset().left,m=jQuery("body"),p=function(){if(!m[0].className)return 0;var e=m[0].className.match(/menu-max-depth-(\d+)/);return e&&e[1]?parseInt(e[1],10):0}();function h(e){var c;r=e.placeholder.prev(".category_item"),i=e.placeholder.next(".category_item"),r[0]==e.item[0]&&(r=r.prev(".category_item")),i[0]==e.item[0]&&(i=i.next(".category_item")),o=r.length?r.offset().top+r.height():0,n=i.length?i.offset().top+i.height()/3:0,t=i.length?i.menuItemDepth():0,a=r.length?(c=r.menuItemDepth()+1)>d.globalMaxDepth?d.globalMaxDepth:c:0}function g(e,t){e.placeholder.updateDepthClass(t,u),u=t}y+=d.isRTL?d.menuList.width():0,d.menuList.sortable({handle:".cat_item a",placeholder:"mediabay-sortable-placeholder",items:"> *",start:function(t,a){var r,i,o,n;d.isRTL&&(a.item[0].style.right="auto"),s=a.item.children(".mediabay_be_placeholder"),e=a.item.menuItemDepth(),g(a,e),o=(a.item.next()[0]==a.placeholder[0]?a.item.next():a.item).childMenuItems(),s.append(o),r=s.outerHeight(),r+=r>0?1*a.placeholder.css("margin-top").slice(0,-2):0,r+=a.helper.outerHeight(),c=r,r-=2,a.placeholder.height(r),l=e,o.each(function(){var e=jQuery(this).menuItemDepth();l=e>l?e:l}),i=a.helper.find(".cat_item a").outerWidth(),i+=d.depthToPx(l-e),i-=2,a.placeholder.width(i),(n=a.placeholder.next(".category_item")).css("margin-top",c+"px"),a.placeholder.detach(),jQuery(this).sortable("refresh"),a.item.after(a.placeholder),n.css("margin-top",0),h(a),d.currentParent=a.item.find(".input_parent_id").val(),d.oldParent=a.item.prev()},stop:function(t,a){var r,i,o=u-e;jQuery(".children_of_"+a.item.attr("id")).length?jQuery(".children_of_"+a.item.attr("id")).insertAfter(a.item):r=s.children().insertAfter(a.item),jQuery.each(jQuery(".new-wrapper"),function(e,t){jQuery(t).insertAfter("#cc_category_item_"+jQuery(t).attr("class").match(/children_of_cc_category_item_(\d)+/)[1])}),i=a.item.find(".item-title .is-submenu"),u>0?i.show():i.hide(),0!==parseInt(o)&&(a.item.updateDepthClass(u),jQuery(".children_of_"+a.item.attr("id")).length?(r=jQuery(".children_of_"+a.item.attr("id")).find(".category_item")).shiftDepthClass(o):r.shiftDepthClass(o),function(e){var t,a=p;if(0==e)return;if(e>0)(t=l+e)>p&&(a=t);else if(e<0&&l==p)for(;!jQuery(".category_item_depth_"+a,d.menuList).length&&a>0;)a--;m.removeClass("menu-max-depth-"+p).addClass("menu-max-depth-"+a),p=a}(o)),d.registerChange(),a.item.updateParentMenuItemDBId(),a.item[0].style.top=0,d.isRTL&&(a.item[0].style.left="auto",a.item[0].style.right=0),0===d.oldParent.childMenuItems().length?d.oldParent.find(".cc_dropdown").removeClass("has_children open"):d.oldParent.find(".cc_dropdown").addClass("has_children open");var n=jQuery("#cc_category_item_"+a.item.find(".input_parent_id").val());n.childMenuItems().length>0&&n.find(".cc_dropdown").addClass("has_children open"),n.find(".cc_dropdown").hasClass("close")&&n.find(".cc_dropdown").trigger("click"),a.item.refreshFoldersPosition()},change:function(e,t){t.placeholder.parent().hasClass("cc_mediabay_category_list")||(r.length?r.after(t.placeholder):d.menuList.prepend(t.placeholder)),h(t)},sort:function(e,r){var s=r.helper.offset(),l=d.isRTL?s.left+r.helper.width():s.left,m=d.negateIfRTL*d.pxToDepth(l-y);m>a||s.top<o?m=a:m<t&&(m=t),m!=u&&g(r,m),n&&s.top+c>n&&(i.after(r.placeholder),h(r),jQuery(this).sortable("refreshPositions"))}})},addNewFolderByContextMenu:function(){var e=this;jQuery(".cc_mediabay_popup ul li > span.cc_add").on("click",function(t){t.preventDefault(),t.stopPropagation(),jQuery(".cc_mediabay_popup").removeClass("popup_opened"),e.insertCategoryToActive(),e.magicSVG(),e.tripleActionsOnCategories(),jQuery(".folder-input").ccMoveCursorToEnd()})},addNewFolderByTopButton:function(){var e=this;jQuery(".cc_mediabay_header .header_top a").on("click",function(t){return t.preventDefault(),t.stopPropagation(),jQuery(".cc_mediabay_popup").removeClass("popup_opened"),jQuery(".folder-input").length?(jQuery(".folder-input").ccMoveCursorToEnd(),!1):(jQuery("ul.cc_mediabay_category_list li").removeClass("rename"),jQuery("#cc_category_item_"+e.mediabayCurrentFolder).length||(e.mediabayCurrentFolder=null,localStorage.removeItem("mediabayCurrentFolder")),jQuery(".active#cc_category_item_"+e.mediabayCurrentFolder).length||(e.mediabayCurrentFolder=null),null==e.mediabayCurrentFolder?(jQuery("#mediabay_be_folder_list").append(e.newCategoryFormTemplate()),e.magicSVG(),e.tripleActionsOnCategories(),jQuery(".folder-input").ccMoveCursorToEnd()):(e.insertCategoryToActive(),e.magicSVG(),e.tripleActionsOnCategories(),jQuery(".folder-input").ccMoveCursorToEnd()),!1)})},insertCategoryToActive:function(){var e=this,t=jQuery("#cc_category_item_"+e.mediabayCurrentFolder).menuItemDepth(),a=t;if((t=parseInt(t)+1)>=e.globalMaxDepth+1)alert("The max Depth is: "+e.globalMaxDepth);else{var r=jQuery("#cc_category_item_"+e.mediabayCurrentFolder).find(".cc_dropdown");if(r.hasClass("close")&&r.trigger("click"),0===jQuery('[class="input_parent_id"][value="'+e.mediabayCurrentFolder+'"]').length)jQuery(e.newCategoryFormTemplate("category_item_depth_"+t)).insertAfter(jQuery("#cc_category_item_"+e.mediabayCurrentFolder));else{var i=jQuery("#cc_category_item_"+e.mediabayCurrentFolder).childMenuItems();jQuery.each(i,function(r,o){jQuery(o).menuItemDepth()<=a?jQuery(e.newCategoryFormTemplate("category_item_depth_"+t)).insertAfter(jQuery(o).prev()):r===i.length-1&&jQuery(e.newCategoryFormTemplate("category_item_depth_"+t)).insertAfter(jQuery(o))})}}},cancelAddingNewCategory:function(){var e=this;jQuery("ul.cc_mediabay_category_list .cat_item a").off().stop(!0,!0).on("click",function(t){t.preventDefault();var a=jQuery(this);e.setActiveCategory(a)}),jQuery(".cc_mediabay_header .header_bottom ul li a").off().stop(!0,!0).on("click",function(t){t.preventDefault();var a=jQuery(this);e.setActiveCategory(a)}),jQuery(document).on("click",".add-new-folder-cancel",function(e){e.preventDefault(),jQuery("li.new_category").fadeOut(300,function(){jQuery(this).remove()})})},addCategoryAjaxProcess:function(e,t,a,r){var i=jQuery.parseJSON(e),o=i.termID,n=i.termName,c=jQuery("<option></option>").attr("value",o).text(n+0),s=this.newCategoryTemplate(o,n,t,a);jQuery("li.category_item.new_category").remove();var l=this.mediabayCurrentFolder;if(null===l)jQuery("#mediabay_be_folder_list").append(s);else if(0===jQuery('[class="input_parent_id"][value="'+l+'"]').length)jQuery(s).insertAfter(jQuery("#cc_category_item_"+l)),jQuery("#cc_category_item_"+l).find(".cc_dropdown").addClass("has_children open");else{var d=jQuery("#cc_category_item_"+l).nextAll(),u=parseInt(d.length-1);jQuery.each(d,function(e,t){if(jQuery(t).menuItemDepth()<=r)return jQuery(s).insertAfter(jQuery(t).prev()),!1;e===u&&jQuery(s).insertAfter(jQuery(t))})}this.magicSVG(),this.callMovingPopup(),mediabayFolders.push({folderID:o,folderName:n,term_count:0}),this.refreshBackbone("add"),jQuery(".wpmediacategory-filter").append(c),this.cancelAddingNewCategory(),this.updateFolderPosition(),t&&this.mediabayState.indexOf(t.toString())<0&&(this.mediabayState.push(t),localStorage.setItem("mediabayTreeState",this.mediabayState)),this.stopPreloader()},appendSidebarToBody:function(){var e="";jQuery(".cc_mediabay_temporary").length&&(e+=jQuery(".cc_mediabay_temporary").html(),jQuery(".cc_mediabay_temporary").remove(),jQuery("#wpbody .wrap").wrapAll('<div class="wrap-all"></div>')),jQuery("body").hasClass("post-type-attachment")&&jQuery("body").addClass("mediabay_ready"),jQuery("#wpbody .wrap").before(e);var t=0;jQuery("#wpadminbar").length&&(t=jQuery("#wpadminbar").outerHeight());var a=jQuery(window).height()-t-40;jQuery(".media-modal-content").length&&(a=jQuery(window).height()-80),jQuery(".cc_mediabay_sidebar").css({height:a}),a-=jQuery(".cc_mediabay_header").outerHeight(),jQuery(".cc_mediabay_sidebar .cc_mediabay_content").css({height:a}),jQuery(".cc_mediabay_sidebar .cc_mediabay_content").niceScroll(),jQuery(window).on("resize",function(){a=jQuery(window).height()-t-20,jQuery(".media-modal-content").length&&(a=jQuery(window).height()-80),jQuery(".cc_mediabay_sidebar").css({height:a}),a-=jQuery(".cc_mediabay_header").outerHeight(),jQuery(".cc_mediabay_sidebar .cc_mediabay_content").css({height:a}),jQuery(".cc_mediabay_sidebar .cc_mediabay_content").getNiceScroll().resize()})},callMovingPopup:function(){var e=this,t=jQuery(".cc_mediabay_popup");jQuery("ul.cc_mediabay_category_list li");jQuery("ul.cc_mediabay_category_list .cc_drag").on("click",function(a){a.preventDefault(),a.stopPropagation(),jQuery("li.new_category").remove();var r=jQuery(this).closest("li"),i=r.data("id");coreFilter.categoryID=i,e.mediabayCurrentFolder=i;var o=r.find(".cc_title").text();r.find("input").val(o);var n=r.offset().top-e.getBodyScrollTop(),c=r.offset().left+r.width();if(t.addClass("popup_opened"),e.isRTL){var s=jQuery(window).width()-r.offset().left;t.css({right:s+"px",top:n+"px"})}else t.css({left:c,top:n});jQuery(window).on("resize",function(){e.recalculateCoordinationsPopup(r,t)}),jQuery(".cc_mediabay_content").on("scroll",function(){e.recalculateCoordinationsPopup(r,t)}),e.tripleActionsOnCategories(r)}),jQuery(window).on("click",function(){jQuery("li.new_category").length&&jQuery("li.new_category").remove(),jQuery(".cc_mediabay_popup").removeClass("popup_opened")})},recalculateCoordinationsPopup:function(e,t){var a=e.offset().top-this.getBodyScrollTop(),r=e.offset().left+e.width();if(this.isRTL){var i=jQuery(window).width()-e.offset().left;t.css({right:i+"px",top:a+"px"})}else t.css({left:r,top:a})},tripleActionsOnCategories:function(e){var t=jQuery(".cc_mediabay_popup"),a=this;t.find(".cc_add").on("click",function(e){e.preventDefault(),e.stopPropagation()}),t.find(".cc_rename").off().on("click",function(a){a.preventDefault(),a.stopPropagation(),e.addClass("rename"),e.find("input").ccMoveCursorToEnd(),t.removeClass("popup_opened")}),t.find(".cc_delete").off().on("click",function(r){r.preventDefault(),r.stopPropagation(),a.checkIfCategoryHasChildren(e)?a.callDeleteErrorPopup():a.callDeleteConfirmPopup(),t.removeClass("popup_opened")}),t.find(".cc_clear").off().on("click",function(r){r.preventDefault(),r.stopPropagation(),a.callClearConfirmPopup(e),t.removeClass("popup_opened")}),jQuery("ul.cc_mediabay_category_list .cc_cancel").off().on("click",function(e){e.preventDefault(),e.stopPropagation();var t=jQuery("ul.cc_mediabay_category_list li.rename");if(t.data("id")){var a=t.find(".cc_title").text();t.find("input").val(a),jQuery("ul.cc_mediabay_category_list li").removeClass("rename")}else t.remove()}),jQuery("ul.cc_mediabay_category_list .cc_apply").off().on("click",function(e){e.preventDefault(),e.stopPropagation();var t=jQuery("ul.cc_mediabay_category_list li.rename"),r=t.find(".cc_title").text(),i=t.find("input").val(),o=t.data("id");a.ifStringIsEmpty(i)?(jQuery.iaoAlert({msg:a.alertWarningIcon+a.enterName,type:"success",alertTime:a.iaoAlertTime,position:a.iaoAlertPosition}),a.magicSVG()):i===r?t.removeClass("rename"):o?a.renameExistingCategory(o,i,t):a.insertNewCategory(i)}),jQuery("ul.cc_mediabay_category_list .cc_changer,ul.cc_mediabay_category_list .cc_btns").on("click",function(e){e.preventDefault(),e.stopPropagation()}),jQuery(window).on("click",function(){if(jQuery("ul.cc_mediabay_category_list li.rename").length){var e=jQuery("ul.cc_mediabay_category_list li.rename"),t=e.find(".cc_title").text();e.find("input").val(t)}jQuery("ul.cc_mediabay_category_list li").removeClass("rename")})},insertNewCategory:function(e){var t=0,a=this;if(a.ifStringIsEmpty(e))jQuery.iaoAlert({msg:a.alertWarningIcon+a.enterName,type:"success",alertTime:a.iaoAlertTime,position:a.iaoAlertPosition}),a.magicSVG();else{var r=0,i=jQuery("#cc_category_item_"+t),o=0;null!==a.mediabayCurrentFolder&&(t=a.mediabayCurrentFolder,i=jQuery("#cc_category_item_"+t),r=i.menuItemDepth(),o=r,r=parseInt(r)+1),a.startPreloader();var n={action:"mediabayAjaxAddCategory",categoryName:e,parent:t};jQuery.ajax({type:"POST",url:a.ajaxurl,cache:!0,data:n,success:function(e){a.addCategoryAjaxProcess(e,t,r,o),a.stopPreloader()},error:function(e,t,a){console.log(a),console.log(t),console.log(e)}})}},renameExistingCategory:function(e,t,a){var r=this;r.startPreloader();var i={action:"mediabayAjaxRenameCategory",categoryID:e,categoryTitle:t};jQuery.ajax({type:"POST",url:r.ajaxurl,cache:!0,data:i,success:function(e){r.renameExistingCategoryAjaxProcess(e,a)},error:function(e,t,a){console.log(a),console.log(t),console.log(e),r.stopPreloader()}})},renameExistingCategoryAjaxProcess:function(e,t){var a=jQuery.parseJSON(e);"no"===a.error?(t.find(".cc_title").text(a.title),t.find("input").val(a.title),t.removeClass("rename")):(jQuery.iaoAlert({msg:this.alertWarningIcon+this.slugError,type:"success",alertTime:this.iaoAlertTime,position:this.iaoAlertPosition}),this.magicSVG()),this.stopPreloader()},callDeleteErrorPopup:function(){jQuery.iaoAlert({msg:this.alertWarningIcon+this.hasSubFolder,type:"success",alertTime:this.iaoAlertTime,position:this.iaoAlertPosition}),this.magicSVG()},callClearConfirmPopup:function(e){var t=this,a=t.confirmToClearDOM();jQuery("#mediabay_be_confirm").remove(),jQuery("body").prepend(a);var r=jQuery("#mediabay_be_confirm");r.addClass("opened folder_clear");var i=(r=jQuery("#mediabay_be_confirm.folder_clear")).find("a.yes"),o=r.find("a.no");i.off().on("click",function(a){return a.preventDefault(),t.clearCategoryAjax(r,e),!1}),o.on("click",function(){return r.removeClass(),r.remove(),!1})},clearCategoryAjax:function(e,t){var a=this,r=coreFilter.categoryID;a.startPreloader();var i={action:"mediabayAjaxClearCategory",categoryID:r};jQuery.ajax({type:"POST",url:a.ajaxurl,cache:!1,data:i,success:function(i){var o=jQuery.parseJSON(i),n=o.count;"no"===o.error&&a.clearCategoryAjaxProcess(r,n,e,t),a.stopPreloader()},error:function(e,t,r){console.log(r),console.log(t),console.log(e),a.stopPreloader()}})},clearCategoryAjaxProcess:function(e,t,a,r){r.find(".cc_count").text(0),this.refreshUncategorizedCount(t),a.remove()},callDeleteConfirmPopup:function(){var e=this,t=e.confirmToDeleteDOM();jQuery("#mediabay_be_confirm").remove(),jQuery("body").prepend(t);var a=jQuery("#mediabay_be_confirm");a.addClass("opened folder_delete");var r=a.find("a.yes"),i=a.find("a.no");r.off().on("click",function(t){return t.preventDefault(),e.deleteCategoryAjax(a),!1}),i.on("click",function(){return a.removeClass(),a.remove(),!1})},deleteCategoryAjax:function(e){var t=this;t.startPreloader();var a=coreFilter.categoryID,r={action:"mediabayAjaxDeleteCategory",categoryID:a};jQuery.ajax({type:"POST",url:t.ajaxurl,cache:!0,data:r,success:function(r){var i=jQuery.parseJSON(r),o=i.count;"no"===i.error&&(t.deleteCategoryAjaxProcess(a,o),jQuery("ul.cc_mediabay_category_list li.active").removeClass("active"),e.remove()),t.stopPreloader()},error:function(e,a,r){console.log(r),console.log(a),console.log(e),t.stopPreloader()}})},deleteCategoryAjaxProcess:function(e,t){this.refreshUncategorizedCount(t),localStorage.removeItem("mediabayCurrentFolder");var a=jQuery("#cc_category_item_"+e).find(".input_parent_id").val();jQuery("#cc_category_item_"+e).remove(),a&&0===jQuery("#cc_category_item_"+a).childMenuItems().length&&jQuery("#cc_category_item_"+a+" .cc_dropdown").removeClass("open close"),coreFilter.categoryID="",this.mediabayCurrentFolder="all"},refreshUncategorizedCount:function(e){var t=jQuery(".cc_mediabay_header .cc_uncategorized a .cc_count").html();t=parseInt(t)+parseInt(e),jQuery(".cc_mediabay_header .cc_uncategorized a .cc_count").html(t)},confirmToClearDOM:function(){var e='<div id="mediabay_be_confirm">';return e+='<div class="confirm_inner">',e+='<div class="desc_holder">',e+="<h3>"+this.areYouSure+"</h3>",e+="<p>"+this.willBeMovedToUncategorized+"</p>",e+="</div>",e+='<div class="links_holder">',e+='<a class="yes" href="#">'+this.clearText+"</a>",e+='<a class="no" href="#">'+this.cancelText+"</a>",e+="</div>",e+="</div>",e+="</div>"},confirmToDeleteDOM:function(){var e='<div id="mediabay_be_confirm">';return e+='<div class="confirm_inner">',e+='<div class="desc_holder">',e+="<h3>"+this.areYouSure+"</h3>",e+="<p>"+this.willBeMovedToUncategorized+"</p>",e+="</div>",e+='<div class="links_holder">',e+='<a class="yes" href="#">'+this.deleteText+"</a>",e+='<a class="no" href="#">'+this.cancelText+"</a>",e+="</div>",e+="</div>",e+="</div>"},checkIfCategoryHasChildren:function(e){return!(!jQuery(e).next().find(".input_parent_id").length||jQuery(e).next().find(".input_parent_id").val()!=coreFilter.categoryID)},magicSVG:function(){jQuery("img.mediabay_be_svg").each(function(){var e=jQuery(this),t=e.attr("class"),a=e.attr("src");jQuery.get(a,function(a){var r=jQuery(a).find("svg");void 0!==t&&(r=r.attr("class",t+" replaced-svg")),r=r.removeAttr("xmlns:a"),e.replaceWith(r)},"xml")})},appendMovingPopup:function(){var e="";e+='<div class="cc_mediabay_popup">',e+="<ul>","Mediabay"==this.plugin&&(e+='<li><span class="cc_add"><span class="cc_text">'+this.newFolderText+"<span></span></span></span></li>",e+='<li><span class="cc_rename">'+this.renameText+"</span></li>",e+='<li><span class="cc_clear">'+this.clearMediaText+"</span></li>"),e+='<li><span class="cc_delete">'+this.deleteText+"</span></li>",e+="</ul>",e+="</div>",jQuery("body").append(e)},newCategoryTemplate:function(e,t,a,r){var i="";return i+='<li id="cc_category_item_'+e+'" data-id="'+e+'" class="category_item category_item_depth_'+r+" parent_"+e+'" data-parent-id="parent_'+a+'">',i+='<div class="cat_item">',i+='<span class="cc_dropdown"></span>',i+='<a href="#">',i+='<span class="cc_icon">'+this.getIcon("folder")+"</span>",i+='<span class="cc_title">'+t+"</span>",i+='<span class="cc_count">0</span>',i+="</a>",i+='<div class="cc_changer"><div>'+this.getIcon("folder")+'<input type="text" value="'+t+'" /></div></div>',i+=this.dragButton(),i+=this.applyCancelButtons(),i+="</div>",i+=this.extraHTMLForNewCategory(e,a),i+="</li>"},newCategoryFormTemplate:function(e){void 0===e&&(e="");var t="";return t+='<li class="category_item active rename new_category '+e+'">',t+='<div class="cat_item">',t+='<span class="cc_dropdown"></span>',t+='<a href="#">',t+='<span class="cc_icon">'+this.getIcon("folder")+"</span>",t+='<span class="cc_title"></span>',t+='<span class="cc_count">0</span>',t+="</a>",t+='<div class="cc_changer"><div>'+this.getIcon("folder")+'<input class="folder-input" type="text" value="" /></div></div>',t+=this.dragButton(),t+=this.applyCancelButtons(),t+="</div>",t+="</li>"},extraHTMLForNewCategory:function(e,t){var a="";return a+='<ul class="mediabay_be_placeholder"></ul>',a+='<input class="input_category_id" type="hidden" value="'+e+'">',a+='<input class="input_parent_id" type="hidden" value="'+t+'">'},dragButton:function(){return'<span class="cc_drag"><span></span></span>'},applyCancelButtons:function(){var e="";return e+='<div class="cc_btns">',e+='<span class="cc_apply">'+this.getIcon("check")+'<span class="cc_tooltip">'+this.confirmText+"</span></span>",e+='<span class="cc_cancel">'+this.getIcon("close")+'<span class="cc_tooltip">'+this.cancelText+"</span></span>",e+="</div>"},getIcon:function(e){return'<img class="mediabay_be_svg" src="'+this.pluginURL+"/assets/img/"+e+'.svg" />'},depthToPx:function(e){return e*this.menuItemDepthPerLevel},pxToDepth:function(e){return Math.floor(e/this.menuItemDepthPerLevel)},registerChange:function(){this.menusChanged=!0},removeDuplicates:function(e){var t=[];return jQuery.each(e,function(e,a){"0"!==(a=a.toString())&&-1===jQuery.inArray(a,t)&&t.push(a)}),t},startPreloader:function(){jQuery(".mediabay_be_loader").addClass("active")},stopPreloader:function(){jQuery(".mediabay_be_loader").removeClass("active")},scrollToElement:function(e,t){jQuery([document.documentElement,document.body]).animate({scrollTop:e.offset().top},t)},setActiveCategory:function(e){jQuery(".cc_mediabay_header .header_bottom ul li").removeClass("active"),this.menuList.find("li").removeClass("active"),e.closest("li").addClass("active"),this.mediabayCurrentFolder=e.closest("li").attr("data-id");var t=this.mediabayCurrentFolder;localStorage.setItem("mediabayCurrentFolder",t),this.isListMode()?(-1!==parseInt(this.mediabayCurrentFolder)&&(this.mediabayIsListNoFolder=0,localStorage.setItem("mediabayIsListNoFolder",this.mediabayIsListNoFolder)),"all"==t&&(t=""),jQuery('select[name="cc_mediabay_folder"]').val(t),jQuery('.wp-admin.upload-php #posts-filter .filter-items input[name="filter_action"]').trigger("click")):(this.startPreloader(),jQuery(".wpmediacategory-filter").val(t),jQuery(".wpmediacategory-filter").trigger("change"),this.refreshBackbone(),jQuery(".attachments").css("height","auto"),localStorage.setItem("mediabayCurrentFolder",t),this.stopPreloader())},refreshBackbone:function(e){var t=jQuery(".cc_mediabay_sidebar"),a=this.getBackboneOfMedia(t);if("add"===e){if("object"==typeof a.view){var r=a.view.toolbar.get("mediabay-filter");"object"==typeof a.view&&r.createFilters()}}else if(a.browser.length>0&&"object"==typeof a.view)try{a.view.collection.props.set({ignore:+new Date})}catch(e){console.log(e)}},isListMode:function(){return!!jQuery('select[name="cc_mediabay_folder"]').length},setForActiveAllFiles:function(){this.startPreloader(),this.mediabayCurrentFolder="all",jQuery('.cc_mediabay_header .header_bottom ul li[data-id="all"]').addClass("active"),jQuery(".wpmediacategory-filter").val(this.mediabayCurrentFolder),jQuery(".wpmediacategory-filter").trigger("change"),jQuery(".attachments").css("height","auto"),localStorage.setItem("mediabayCurrentFolder",this.mediabayCurrentFolder),this.stopPreloader()},ifStringIsEmpty:function(e){return!e||/^\s*jQuery/.test(e)},getBodyScrollTop:function(){return this.pageYOffset||document.documentElement&&document.documentElement.scrollTop||document.body&&document.body.scrollTop},getBackboneOfMedia:function(e){var t,a,r=e.parents(".media-modal");return a=(t=r.length>0?r.find(".attachments-browser"):jQuery("#wpbody-content .attachments-browser")).data("backboneView"),{browser:t,view:a}},executeSearch:function(){var e=this,t=jQuery.trim(jQuery("#mediabay-search").val()).toLowerCase(),a=jQuery("li.category_item");""!=t?(a.addClass("hide-for-search"),a.each(function(){var r=jQuery(this),i=r.data("parent-id"),o=r.find(".cc_title").text().toLowerCase();t=new RegExp(t,"g"),o.match(t)&&(r.removeClass("hide-for-search"),"parent_0"!=i&&e.removeParentClass(a,i))})):a.removeClass("hide-for-search")},removeParentClass:function(e,t){var a=this;e.each(function(){var r=jQuery(this);if(r.hasClass(t)){r.removeClass("hide-for-search");var i=r.data("parent-id");"parent_0"!=i&&a.removeParentClass(e,i)}})},startSearchFolder:function(){var e=this;jQuery(document).on("keyup","#mediabay-search",function(){e.executeSearch()}),jQuery(document).on("change","#mediabay-search",function(){e.executeSearch()}),jQuery(document).on("blur","#mediabay-search",function(){e.executeSearch()})}};!function(e){"use strict";e(document).ready(function(){MediabayCore.init()})}(jQuery);